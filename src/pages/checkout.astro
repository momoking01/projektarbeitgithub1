---
import Layout from "../components/layout.astro";
---

<Layout>
  <div class="checkout-container">
    <h1>Checkout</h1>
    <p><strong>Total Items:</strong> <span id="total-items">0</span></p>

    <h2>Order Summary</h2>
    <ul id="order-summary"></ul>

    <h2>Payment Method</h2>
    <select id="payment-method">
      <option value="cash">Cash</option>
      <option value="sepa">SEPA Direct Debit</option>
    </select>

    <button onclick="placeOrder()">Place Order</button>
  </div>
</Layout>

<script>
  function loadCartSummary() {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    let totalItems = document.getElementById("total-items");
    let orderSummary = document.getElementById("order-summary");

    let totalCount = 0;
    orderSummary.innerHTML = "";

    cart.forEach(item => {
      totalCount += item.quantity;
      let li = document.createElement("li");
      li.textContent = `${item.name} (x${item.quantity})`;
      orderSummary.appendChild(li);
    });

    totalItems.textContent = totalCount;
  }

  function placeOrder() {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    if (cart.length === 0) {
      alert("Your cart is empty.");
      return;
    }

    let paymentMethod = document.getElementById("payment-method").value;
    let orders = JSON.parse(localStorage.getItem("orders")) || [];

    let newOrder = {
      date: new Date().toISOString(),
      items: cart,
      payment: paymentMethod
    };

    orders.push(newOrder);
    localStorage.setItem("orders", JSON.stringify(orders));
    localStorage.removeItem("cart");

    alert("Order placed successfully!");
    window.location.href = "/projektarbeitgithub1/orders";
  }

  window.onload = loadCartSummary;
</script>

<style>
  .checkout-container {
    text-align: center;
    padding: 20px;
  }

  select, button {
    margin: 10px;
    padding: 5px;
  }
</style>